<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RandImg - éšæœºå›¾ç‰‡APIæœåŠ¡</title>
    <link rel="stylesheet" href="css/home.css">
</head>
<body>
    <div class="background" id="background"></div>
    <div class="background-overlay"></div>

    <div class="container">
        <h1>ğŸ¨ RandImg</h1>
        <p class="subtitle">å¼ºå¤§çš„éšæœºå›¾ç‰‡APIæœåŠ¡ - æ”¯æŒå¤šå›¾æºã€ç¼“å­˜ã€é™æµã€ä»£ç†</p>

        <div class="features">
            <div class="feature">
                <div class="feature-icon">ğŸš€</div>
                <div class="feature-title">é«˜æ€§èƒ½</div>
                <div class="feature-desc">å†…å­˜é™æµ+å¼‚æ­¥ç»Ÿè®¡</div>
            </div>
            <div class="feature">
                <div class="feature-icon">ğŸ”’</div>
                <div class="feature-title">å®‰å…¨å¯é </div>
                <div class="feature-desc">API Keyè®¤è¯</div>
            </div>
            <div class="feature">
                <div class="feature-icon">ğŸ¯</div>
                <div class="feature-title">çµæ´»é…ç½®</div>
                <div class="feature-desc">å¤šç§è¿”å›æ ¼å¼</div>
            </div>
            <div class="feature">
                <div class="feature-icon">ğŸ“Š</div>
                <div class="feature-title">æ•°æ®ç»Ÿè®¡</div>
                <div class="feature-desc">å®Œæ•´çš„ä½¿ç”¨åˆ†æ</div>
            </div>
        </div>

        <div class="api-docs">
            <h2>ğŸ“– API ä½¿ç”¨æ–‡æ¡£</h2>

            <div class="api-section">
                <h3>1. éšæœºå›¾ç‰‡æ¥å£</h3>
                <div class="api-endpoint">
                    <code>GET /api/random</code>
                </div>
                <div class="api-params">
                    <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                    <table>
                        <tr>
                            <th>å‚æ•°</th>
                            <th>ç±»å‹</th>
                            <th>å¿…å¡«</th>
                            <th>è¯´æ˜</th>
                        </tr>
                        <tr>
                            <td><code>category</code></td>
                            <td>string</td>
                            <td>å¦</td>
                            <td>åˆ†ç±»slugï¼ˆå¦‚ï¼šacgã€wallpaperï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>device</code></td>
                            <td>string</td>
                            <td>å¦</td>
                            <td>è®¾å¤‡ç±»å‹ï¼š<code>pc</code>ï¼ˆæ¨ªå±ï¼‰æˆ– <code>mobile</code>ï¼ˆç«–å±ï¼‰<br>
                                <strong>ä¸æŒ‡å®šæ—¶è‡ªåŠ¨ä»User-Agentè¯†åˆ«ï¼Œé»˜è®¤pc</strong></td>
                        </tr>
                        <tr>
                            <td><code>format</code></td>
                            <td>string</td>
                            <td>å¦</td>
                            <td>è¿”å›æ ¼å¼ï¼š<code>redirect</code>ï¼ˆé»˜è®¤ï¼Œ302é‡å®šå‘ï¼‰ã€<code>json</code>ï¼ˆJSONæ•°æ®ï¼‰ã€<code>proxy</code>ï¼ˆä»£ç†å›¾ç‰‡ï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>compress</code></td>
                            <td>boolean</td>
                            <td>å¦</td>
                            <td>æ˜¯å¦å‹ç¼©å›¾ç‰‡ï¼ˆä»…proxyæ¨¡å¼æœ‰æ•ˆï¼‰ï¼š<code>true</code> æˆ– <code>false</code>ï¼ˆé»˜è®¤ï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>api_key</code></td>
                            <td>string</td>
                            <td>è·¨åŸŸå¿…å¡«</td>
                            <td>APIå¯†é’¥ï¼ˆåŒæºè®¿é—®æ— éœ€æä¾›ï¼‰</td>
                        </tr>
                    </table>
                </div>
                <div class="api-examples">
                    <h4>ä½¿ç”¨ç¤ºä¾‹ï¼š</h4>
                    <pre># æœ€ç®€å•çš„ç”¨æ³•ï¼ˆè‡ªåŠ¨è¯†åˆ«è®¾å¤‡ï¼‰
&lt;img src="<span id="demo-url-1"></span>/api/random"&gt;

# æŒ‡å®šåˆ†ç±»å’Œè®¾å¤‡
&lt;img src="<span id="demo-url-2"></span>/api/random?category=acg&device=mobile"&gt;

# è·å–JSONæ•°æ®
curl "<span id="demo-url-3"></span>/api/random?format=json"

# è·¨åŸŸè°ƒç”¨ï¼ˆéœ€è¦API Keyï¼‰
curl "<span id="demo-url-4"></span>/api/random?api_key=YOUR_KEY&format=json"</pre>
                </div>
            </div>

            <div class="api-section">
                <h3>2. å›¾ç‰‡ä»£ç†æ¥å£</h3>
                <div class="api-endpoint">
                    <code>GET /api/proxy/:id</code>
                </div>
                <div class="api-params">
                    <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                    <table>
                        <tr>
                            <th>å‚æ•°</th>
                            <th>ç±»å‹</th>
                            <th>å¿…å¡«</th>
                            <th>è¯´æ˜</th>
                        </tr>
                        <tr>
                            <td><code>id</code></td>
                            <td>number</td>
                            <td>æ˜¯</td>
                            <td>å›¾ç‰‡IDï¼ˆè·¯å¾„å‚æ•°ï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>compress</code></td>
                            <td>boolean</td>
                            <td>å¦</td>
                            <td>æ˜¯å¦å‹ç¼©ï¼š<code>true</code> æˆ– <code>false</code>ï¼ˆé»˜è®¤ï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>format</code></td>
                            <td>string</td>
                            <td>å¦</td>
                            <td>ç›®æ ‡æ ¼å¼ï¼š<code>jpeg</code>ã€<code>png</code></td>
                        </tr>
                    </table>
                </div>
                <div class="api-examples">
                    <h4>ä½¿ç”¨ç¤ºä¾‹ï¼š</h4>
                    <pre># ä»£ç†åŸå›¾
&lt;img src="<span id="demo-url-5"></span>/api/proxy/123"&gt;

# å‹ç¼©å¹¶è½¬æ¢ä¸ºJPEG
&lt;img src="<span id="demo-url-6"></span>/api/proxy/123?compress=true&format=jpeg"&gt;</pre>
                </div>
            </div>

            <div class="api-section">
                <h3>3. å›¾ç‰‡åˆ—è¡¨æ¥å£</h3>
                <div class="api-endpoint">
                    <code>GET /api/images</code>
                </div>
                <div class="api-params">
                    <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                    <table>
                        <tr>
                            <th>å‚æ•°</th>
                            <th>ç±»å‹</th>
                            <th>å¿…å¡«</th>
                            <th>è¯´æ˜</th>
                        </tr>
                        <tr>
                            <td><code>page</code></td>
                            <td>number</td>
                            <td>å¦</td>
                            <td>é¡µç ï¼ˆé»˜è®¤1ï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>page_size</code></td>
                            <td>number</td>
                            <td>å¦</td>
                            <td>æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>category</code></td>
                            <td>string</td>
                            <td>å¦</td>
                            <td>åˆ†ç±»slug</td>
                        </tr>
                        <tr>
                            <td><code>device</code></td>
                            <td>string</td>
                            <td>å¦</td>
                            <td>è®¾å¤‡ç±»å‹ï¼š<code>pc</code> æˆ– <code>mobile</code></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="api-section">
                <h3>4. åˆ†ç±»åˆ—è¡¨æ¥å£</h3>
                <div class="api-endpoint">
                    <code>GET /api/categories</code>
                </div>
                <div class="api-examples">
                    <h4>ä½¿ç”¨ç¤ºä¾‹ï¼š</h4>
                    <pre>curl "<span id="demo-url-7"></span>/api/categories"</pre>
                </div>
            </div>

            <div class="api-section">
                <h3>ğŸ”‘ è®¤è¯è¯´æ˜</h3>
                <ul>
                    <li><strong>åŒæºè®¿é—®</strong>ï¼šå‰ç«¯é¡µé¢è®¿é—®APIæ— éœ€API Keyï¼Œä¸é™æµ</li>
                    <li><strong>è·¨åŸŸè®¿é—®</strong>ï¼šéœ€è¦åœ¨URLä¸­æ·»åŠ  <code>?api_key=YOUR_KEY</code> å‚æ•°</li>
                    <li><strong>ç®¡ç†API</strong>ï¼šéœ€è¦åœ¨è¯·æ±‚å¤´æ·»åŠ  <code>Authorization: Bearer admin_secret_token</code></li>
                </ul>
            </div>

            <div class="api-section">
                <h3>âš¡ é™æµè§„åˆ™</h3>
                <ul>
                    <li>åŒæºè®¿é—®ï¼š<strong>ä¸é™æµ</strong></li>
                    <li>è·¨åŸŸè®¿é—®ï¼šæ ¹æ®API Keyé…ç½®çš„é™æµè§„åˆ™ï¼ˆé»˜è®¤ï¼š100æ¬¡/åˆ†é’Ÿï¼‰</li>
                    <li>é™æµç®—æ³•ï¼šæ»‘åŠ¨çª—å£ï¼ˆå†…å­˜å®ç°ï¼Œé«˜æ€§èƒ½ï¼‰</li>
                </ul>
            </div>
        </div>

        <div class="api-demo">
            <h3>ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
            <div># è·å–éšæœºå›¾ç‰‡ï¼ˆJSONæ ¼å¼ï¼‰</div>
            <div>curl "<code><span id="demo-url-8"></span>/api/random?api_key=YOUR_KEY&format=json</code>"</div>
            <br>
            <div># è·å–éšæœºå›¾ç‰‡ï¼ˆ302é‡å®šå‘ï¼‰</div>
            <div>curl -L "<code><span id="demo-url-9"></span>/api/random?api_key=YOUR_KEY</code>"</div>
            <br>
            <div># æŒ‰åˆ†ç±»è·å–</div>
            <div>curl "<code><span id="demo-url-10"></span>/api/random?api_key=YOUR_KEY&category=acg</code>"</div>
        </div>

        <div class="buttons">
            <a href="/admin" class="btn btn-primary">ç®¡ç†åå°</a>
            <a href="/gallery" class="btn btn-secondary">å›¾ç‰‡ç”»å»Š</a>
            <a href="https://github.com/yourusername/randimg" class="btn btn-secondary" target="_blank">GitHub</a>
        </div>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="stat-images">-</div>
                <div class="stat-label">æ€»å›¾ç‰‡æ•°</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-calls">-</div>
                <div class="stat-label">æ€»è°ƒç”¨æ¬¡æ•°</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-today">-</div>
                <div class="stat-label">ä»Šæ—¥è°ƒç”¨</div>
            </div>
        </div>
    </div>

    <div class="refresh-bg" onclick="refreshBackground()" title="æ¢ä¸€å¼ èƒŒæ™¯">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
        </svg>
    </div>

    <script>
        // è·å–å½“å‰åŸŸå
        const baseURL = window.location.origin;

        // å¡«å……æ‰€æœ‰ç¤ºä¾‹URLä¸­çš„åŸŸå
        document.addEventListener('DOMContentLoaded', function() {
            for (let i = 1; i <= 10; i++) {
                const elem = document.getElementById(`demo-url-${i}`);
                if (elem) elem.textContent = baseURL;
            }
        });

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                document.getElementById('stat-images').textContent = data.total_images || 0;
                document.getElementById('stat-calls').textContent = data.total_calls || 0;
                document.getElementById('stat-today').textContent = data.today_calls || 0;
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // è®¾ç½®éšæœºèƒŒæ™¯
        function setRandomBackground() {
            // åŒæºè®¿é—®ä¸éœ€è¦API key
            const bgUrl = '/api/random?category=acg&format=redirect';
            document.getElementById('background').style.backgroundImage = `url('${bgUrl}')`;
        }

        // åˆ·æ–°èƒŒæ™¯
        function refreshBackground() {
            const bg = document.getElementById('background');
            bg.style.opacity = '0';
            setTimeout(() => {
                setRandomBackground();
                bg.style.transition = 'opacity 0.5s';
                bg.style.opacity = '1';
            }, 500);
        }

        // åˆå§‹åŒ–
        loadStats();
        setRandomBackground();
    </script>
</body>
</html>
